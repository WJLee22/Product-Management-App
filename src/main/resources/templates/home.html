<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="https://www.thymeleaf.org/extras/spring-security">
<head>
    <title>SpringBoot Security</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css">
</head>

<body>
<div class="container mt-4">
    <!-- 로그인 성공/실패 메시지 표시 -->
    <div th:if="${session.message}" class="alert" th:classappend="${session.alertClass}" role="alert">
        <span th:text="${session.message}"></span>
        <th:block th:text="${#session.removeAttribute('message')}"></th:block>
        <th:block th:text="${#session.removeAttribute('alertClass')}"></th:block>
    </div>

    <h2> 안녕하세요. 스프링 부트 보안 사이트에 오신 것을 환영합니다 </h2>

    <!-- 인증이 되어있느냐. 되어있으면 div 엘리먼트 렌더링 ㅇㅇ -->
    <div sec:authorize="isAuthenticated()">
        <!-- 인증 후, 인증된 유저의 유저이름을 출력 -->
        <p>Welcome <span sec:authentication="principal.username">User</span></p>

        <div class="d-flex gap-2 mb-3">
            <form th:action="@{/logout}" method="post" class="d-inline">
                <button type="submit" class="btn btn-danger">로그아웃</button>
            </form>
            <a th:href="@{/products}" class="btn btn-primary">상품 목록</a>
        </div>

        <!-- 관리자 권한이 있으면 -->
        <div sec:authorize="hasRole('ROLE_ADMIN')" class="my-3">
            <h3>관리자 메뉴</h3>
            <div class="d-flex gap-2">
                <a th:href="@{/admin/users}" class="btn btn-info">사용자 목록</a>
                <a th:href="@{/products/new}" class="btn btn-success">상품 등록</a>
            </div>
        </div>

        <div class="mt-3">
            <h4>사용자 역할:</h4>
            <!-- 인증이 되어있으면 -->
            <div sec:authorize="isAuthenticated()">
                <div th:each="authority : ${#authentication.authorities}">
                    <span class="badge bg-secondary" th:text="${authority.getAuthority()}">[Authority]</span>
                </div>
            </div>
        </div>
    </div>

    <!-- 인증이 되어있지않다면 로그인하라는 의미에서 login URL로 리다이렉트시킴 -->
    <div sec:authorize="isAnonymous()" class="mt-3">
        <div class="d-flex gap-2">
            <a th:href="@{/login}" class="btn btn-primary">로그인</a>
            <a th:href="@{/signup}" class="btn btn-secondary">회원가입</a>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>